# smart-class/backend/Dockerfile
# === Etapa base ===
FROM node:20-alpine

# DiretÃ³rio de trabalho dentro do container
WORKDIR /app

# Copiar apenas arquivos de dependÃªncia primeiro (cache de build)
COPY package*.json ./

# Instalar dependÃªncias (apenas produÃ§Ã£o)
RUN npm ci --omit=dev

# Copiar restante do cÃ³digo
COPY . .

# Gerar o Prisma Client dentro do container
RUN npx prisma generate

# VariÃ¡veis padrÃ£o
ENV NODE_ENV=production \
    PORT=5000

# Expor a porta utilizada pelo backend
EXPOSE 5000

# ğŸ”¥ Comando de inicializaÃ§Ã£o com migraÃ§Ãµes automÃ¡ticas
CMD ["sh", "-c", "npx prisma migrate deploy && npm start"]
